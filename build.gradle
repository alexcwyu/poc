group 'net.alexyu'
version '1.0-SNAPSHOT'

apply plugin: 'idea'

buildscript {
    ext {
        springBootVersion = '2.0.1.RELEASE'
        springVersion = '5.0.5.RELEASE'
        grpcVersion = '1.11.0'
        grpcspringBootVersion = '2.3.1'
        protocVersion = '3.5.1-1'
        protobufVersion = '3.5.1'
        protobufGradleVersion = '0.8.5'
        kryoVersion = '2.24.0'
        flatbuffersVersion = '1.8.0'
        guavaVersion = '24.1-jre'
        slf4jVersion = '1.7.25'
        log4jVersion = '2.11.0'
        junitVersion = '4.12'
        mockitoVersion = '2.18.3'
        jodaTimeVersion = '2.9.9'
        rxJavaVersion = '2.1.12'
        reactorVersion = '3.1.6.RELEASE'
        kotlinVersion = '1.2.40'
        samzaVersion = '0.14.0'
        confluentVersion = '4.1.0'
        kafkaVersion = '1.1.0'
        avroVersion = '1.8.2'
        disruptorVersion = '3.4.2'
        lombokVersion = '1.16.20'
        sparkVersion = '2.3.0'
        igniteVersion = '2.4.0'
        elasticsearchVersion = '6.2.3'
        flinkVersion = '1.4.2'
        rocksDBVersion = '5.11.3'
        influxDBVersion = '2.9'
        jacksonVersion = '2.9.5'
        cassandraVersion = '3.11.2'
        datastaxVersion = '3.4.0'
        akkaVersion = '2.5.12'
        postgresqlVersion = '42.2.2'
        jedisVersion = '2.9.0'
    }
    repositories {
        mavenCentral()
        jcenter()
        maven { url 'http://repo.spring.io/plugins-release' }
        maven { url "https://plugins.gradle.org/m2/" }

    }
    dependencies {
        classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
        classpath "com.jfrog.bintray.gradle:gradle-bintray-plugin:1.5"
        classpath "com.google.protobuf:protobuf-gradle-plugin:${protobufGradleVersion}"
        classpath group: 'com.netflix.nebula', name: 'nebula-project-plugin', version: '2.2.1'
        classpath group: 'com.netflix.nebula', name: 'nebula-interactive', version: '2.0.+'
        classpath "org.jfrog.buildinfo:build-info-extractor-gradle:4.0.0"
    }
}


subprojects {

    apply plugin: 'eclipse'
    apply plugin: 'java'
    apply plugin: 'jacoco'
    apply plugin: 'nebula-interactive'

    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    repositories {
        mavenLocal()
        mavenCentral()
        jcenter()
        maven { url "https://repo.spring.io/milestone" }
        maven { url "https://packages.confluent.io/maven/" }
    }

    dependencies {
        compileOnly("org.projectlombok:lombok:${lombokVersion}")
    }

}

task codeCoverageReport(type: JacocoReport) {
    executionData fileTree(project.rootDir.absolutePath).include("**/build/jacoco/*.exec")

    subprojects.each {
        sourceSets it.sourceSets.main
    }

    reports {
        xml.enabled true
        xml.destination "${buildDir}/reports/jacoco/report.xml"
        html.enabled false
        csv.enabled false
    }
}

codeCoverageReport.dependsOn {
    subprojects*.test
}

//
//task wrapper(type: Wrapper) {
//    gradleVersion = '4.6'
//}
